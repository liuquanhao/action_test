name: build openwrt
on: push
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Installation depends
              run: |
                  sudo apt update
                  sudo apt -y install subversion g++ zlib1g-dev build-essential git python python3 libncurses5-dev gawk gettext unzip file libssl-dev wget libelf-dev ecj fastjar java-propose-classpath build-essential libncursesw5-dev python unzip
            - name: clone openwrt code
              run: |
                  git clone https://github.com/openwrt/openwrt
                  cd openwrt
                  ./scripts/feeds update -a
                  ./scripts/feeds install -a
            - name: Generate config file
              run: |
                  cd openwrt
                  make defconfig
            - name: Download package
              run: |
                  cd openwrt && make download -j8
                  find dl -size -1024c -exec ls -l {} \;
                  find dl -size -1024c -exec rm -f {} \;
            - name: Build
              run: |
                  cd openwrt
                  make -j$(nproc) || make -j1
            - name: Upload artifact
              uses: actions/upload-artifact@master
              with:
                  name: Openwrt
                  path: openwrt/bin
